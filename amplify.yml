version: 1
frontend:
  phases:
    preBuild:
      commands:
        - nvm use 20
        - npm ci
        - echo "Checking environment variables..."
        - echo "GMAIL_USER is ${GMAIL_USER:+SET}"
        - echo "GMAIL_APP_PASSWORD is ${GMAIL_APP_PASSWORD:+SET}"
        - echo "CONTACT_EMAIL is ${CONTACT_EMAIL:+SET}"
    build:
      commands:
        - export GMAIL_USER=$GMAIL_USER
        - export GMAIL_APP_PASSWORD=$GMAIL_APP_PASSWORD
        - export CONTACT_EMAIL=$CONTACT_EMAIL
        - export RESEND_API_KEY=$RESEND_API_KEY
        - export RESEND_DNS_VERIFIED=$RESEND_DNS_VERIFIED
        - export RESEND_FROM_ADMIN=$RESEND_FROM_ADMIN
        - export RESEND_FROM_CUSTOMER=$RESEND_FROM_CUSTOMER
        - echo "RESEND_API_KEY is ${RESEND_API_KEY:+SET}"
        - NEXT_TELEMETRY_DISABLED=1 npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*